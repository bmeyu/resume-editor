<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能简历编辑器 - 带照片上传功能</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="i18n.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #3b82f6;
            --text-dark: #333333;
            --text-light: #666666;
            --bg-light: #f8fafc;
            --border-color: #e2e8f0;
            --toolbar-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        [data-theme="dark"] {
            --text-dark: #e2e8f0;
            --text-light: #94a3b8;
            --bg-light: #1e293b;
            --border-color: #334155;
            --toolbar-bg: #0f172a;
            --shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'PingFang SC', system-ui, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light);
            transition: background 0.3s;
            padding: 20px;
            min-height: 100vh;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
        }
        
        [data-theme="dark"] body {
            background-image: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
        }
        
        /* 控制面板样式 */
        .control-panel {
            background: var(--toolbar-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .panel-title {
            font-size: 1.4rem;
            color: var(--primary-color);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title i {
            font-size: 1.2rem;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-group h3 i {
            color: var(--primary-color);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
        }
        
        .btn i {
            font-size: 1.1rem;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-outline:hover {
            background: rgba(37, 99, 235, 0.1);
        }
        
        .color-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.active {
            transform: scale(1.15);
            border: 2px solid var(--text-dark);
            box-shadow: 0 0 0 3px var(--primary-color);
        }
        
        .theme-toggle {
            background: var(--toolbar-bg);
            border: 1px solid var(--border-color);
            display: flex;
            border-radius: 50px;
            overflow: hidden;
            margin-top: 10px;
        }

        .language-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .lang-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border-color);
            background: var(--toolbar-bg);
            color: var(--text-dark);
            border-radius: 6px;
            font-weight: 500;
        }

        .lang-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .lang-btn:hover:not(.active) {
            border-color: var(--secondary-color);
        }
        
        .theme-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .theme-btn.active {
            background: var(--primary-color);
            color: white;
        }
        
        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .export-options .btn {
            flex: 1;
        }
        
        /* 简历编辑区域 */
        .resume-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            min-height: 100vh;
            position: relative;
        }
        
        [data-theme="dark"] .resume-container {
            background: #0f172a;
        }
        
        .resume-content {
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* 照片上传区域 */
        .photo-container {
            float: right;
            margin-left: 20px;
            margin-bottom: 10px;
            width: 140px;
            height: 180px;
            border: 1px dashed var(--border-color);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #f9fafb;
            position: relative; /* For action buttons */
        }
        
        .photo-preview {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-position: center;
        }
        
        .photo-placeholder {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
        }
        
        .photo-placeholder i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .photo-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.5);
            padding: 8px;
            display: flex;
            justify-content: center;
            gap: 10px;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        
        .photo-container:hover .photo-actions {
            transform: translateY(0);
        }
        
        .photo-btn {
            background: rgba(255,255,255,0.9);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-dark);
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .photo-btn:hover {
            background: var(--primary-color);
            color: white;
        }
        
        /* 简历头部样式 */
        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-top: 20px;
            position: relative;
        }
        
        h1 {
            font-size: 2.4rem;
            margin-bottom: 0.25rem;
            color: var(--primary-color);
            outline: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        h1:focus {
            background: rgba(37, 99, 235, 0.05);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
        }
        
        .job-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 1.5rem;
            outline: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .job-title:focus {
            background: rgba(37, 99, 235, 0.05);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
        }
        
        .contact {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 0.5rem;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            outline: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .contact-item:focus {
            background: rgba(37, 99, 235, 0.05);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
        }
        
        /* 模块通用样式 */
        section {
            margin-bottom: 2.5rem;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 1.8rem;
        }
        
        h2 {
            font-size: 1.5rem;
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .add-btn {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .add-btn:hover {
            background: var(--primary-color);
            color: white;
        }
        
        /* 摘要样式 */
        .summary {
            background: rgba(37, 99, 235, 0.05);
            padding: 1.5rem;
            border-radius: 8px;
            font-size: 1.05rem;
            outline: none;
            line-height: 1.7;
            min-height: 100px;
            transition: all 0.2s;
        }
        
        .summary:focus {
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
            background: rgba(37, 99, 235, 0.08);
        }
        
        /* 经历条目样式 */
        .experience-item, .project-item {
            margin-bottom: 2rem;
            background: rgba(37, 99, 235, 0.03);
            border-radius: 8px;
            padding: 1.2rem;
            transition: all 0.2s;
            position: relative;
        }
        
        .experience-item:focus-within, .project-item:focus-within {
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
            background: rgba(37, 99, 235, 0.05);
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 0.5rem;
            gap: 10px;
        }
        
        .company, .project-name {
            font-weight: 600;
            font-size: 1.15rem;
            outline: none;
            padding: 3px 6px;
            border-radius: 4px;
            flex: 1;
        }
        
        .company:focus, .project-name:focus {
            background: rgba(37, 99, 235, 0.05);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
        }
        
        .date {
            color: var(--text-light);
            font-size: 0.95rem;
            outline: none;
            padding: 3px 6px;
            border-radius: 4px;
        }
        
        .date:focus {
            background: rgba(37, 99, 235, 0.05);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
        }
        
        .position {
            font-style: italic;
            margin-bottom: 0.8rem;
            color: var(--text-light);
            outline: none;
            padding: 3px 6px;
            border-radius: 4px;
        }
        
        .position:focus {
            background: rgba(37, 99, 235, 0.05);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
        }
        
        ul {
            padding-left: 1.5rem;
        }
        
        li {
            margin-bottom: 0.6rem;
            position: relative;
            outline: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        li:focus {
            background: rgba(37, 99, 235, 0.05);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
        }
        
        li::before {
            content: "●";
            color: var(--primary-color);
            position: absolute;
            left: -1.2rem;
            font-size: 0.8rem;
        }
        
        /* 技能样式 */
        .skills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
        }
        
        .skill-tag {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.95rem;
            outline: none;
            transition: all 0.2s;
        }
        
        .skill-tag:focus {
            background: rgba(37, 99, 235, 0.2);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
        }

        .skill-tag span {
            outline: none;
        }

        .delete-tag-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            margin-left: 8px;
            font-size: 1.1rem;
            opacity: 0.6;
            transition: all 0.2s;
        }

        .skill-tag:hover .delete-tag-btn {
            opacity: 1;
        }

        .delete-tag-btn:hover {
            transform: scale(1.2);
            color: #dc2626; /* 红色以示危险操作 */
        }
        
        /* AI提示区域 */
        .ai-tips {
            background: rgba(37, 99, 235, 0.05);
            border-left: 4px solid var(--primary-color);
            padding: 1.2rem;
            border-radius: 0 8px 8px 0;
            margin-top: 1.5rem;
            font-size: 0.95rem;
        }
        
        .ai-tips strong {
            color: var(--primary-color);
        }
        
        .ai-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 8px 12px;
            background: rgba(37, 99, 235, 0.05);
            border-radius: 6px;
            cursor: pointer;
        }
        
        .ai-toggle input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(220, 38, 38, 0.1);
            color: #dc2626;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .delete-btn:hover {
            background: #dc2626;
            color: white;
        }
        
        /* 响应式适配 */
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .control-panel {
                position: relative;
                top: 0;
            }
        }
        
        @media (max-width: 700px) {
            .resume-content {
                padding: 25px 15px;
            }
            
            .photo-container {
                position: relative;
                top: 0;
                right: 0;
                width: 120px;
                height: 160px;
                margin: 0 auto 20px;
            }
            
            .contact {
                gap: 0.8rem;
                justify-content: flex-start;
            }
            
            .item-header {
                flex-direction: column;
            }
            
            .date {
                margin-top: 0.2rem;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
        
        /* 通知样式 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(120%);
            transition: transform 0.3s ease-out;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 左侧控制面板 -->
        <div class="control-panel">
            <h2 class="panel-title"><i class="fas fa-tools"></i> <span data-i18n-key="resumeEditor">简历编辑器</span></h2>
            
            <div class="control-group">
                <h3><i class="fas fa-camera"></i> <span data-i18n-key="photoUpload">照片上传</span></h3>
                <div class="photo-upload">
                    <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                    <button class="btn" id="uploadPhotoBtn">
                        <i class="fas fa-upload"></i> <span data-i18n-key="selectPhoto">选择照片</span>
                    </button>
                    <div class="ai-toggle">
                        <input type="checkbox" id="showPhoto" checked>
                        <label for="showPhoto" data-i18n-key="showPhotoInResume">在简历中显示照片</label>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <h3><i class="fas fa-paint-brush"></i> <span data-i18n-key="themeColor">主题颜色</span></h3>
                <div class="color-options">
                    <div class="color-option active" style="background-color: #2563eb;" data-color="#2563eb"></div>
                    <div class="color-option" style="background-color: #0ea5e9;" data-color="#0ea5e9"></div>
                    <div class="color-option" style="background-color: #8b5cf6;" data-color="#8b5cf6"></div>
                    <div class="color-option" style="background-color: #ec4899;" data-color="#ec4899"></div>
                    <div class="color-option" style="background-color: #10b981;" data-color="#10b981"></div>
                    <div class="color-option" style="background-color: #f59e0b;" data-color="#f59e0b"></div>
                </div>
            </div>
            
            <div class="control-group">
                <h3><i class="fas fa-language"></i> <span data-i18n-key="language">语言</span></h3>
                <div class="language-options">
                    <button class="lang-btn active" data-lang="zh">中文</button>
                    <button class="lang-btn" data-lang="en">English</button>
                </div>
            </div>

            <div class="control-group">
                <h3><i class="fas fa-moon"></i> <span data-i18n-key="colorMode">颜色模式</span></h3>
                <div class="theme-toggle">
                    <div class="theme-btn active" data-theme="light" data-i18n-key="lightMode">浅色模式</div>
                    <div class="theme-btn" data-theme="dark" data-i18n-key="darkMode">深色模式</div>
                </div>
            </div>
            
            <div class="control-group">
                <h3><i class="fas fa-file-export"></i> <span data-i18n-key="exportOptions">导出选项</span></h3>
                <div class="export-options">
                    <button class="btn" id="exportPdf">
                        <i class="fas fa-file-pdf"></i> <span data-i18n-key="exportPdf">导出PDF</span>
                    </button>
                </div>
                <button class="btn btn-outline" id="saveLocal">
                    <i class="fas fa-save"></i> <span data-i18n-key="saveToLocal">保存到本地</span>
                </button>
                <button class="btn btn-outline" id="loadLocal">
                    <i class="fas fa-folder-open"></i> <span data-i18n-key="loadFromLocal">从本地加载</span>
                </button>
                <button class="btn btn-outline" id="resetTemplate" style="border-color: #f43f5e; color: #f43f5e;">
                    <i class="fas fa-sync-alt"></i> <span data-i18n-key="resetTemplate">重置为模板</span>
                </button>
            </div>

            <div class="control-group">
                <h3><i class="fas fa-briefcase"></i> <span data-i18n-key="smartMatching">智能匹配</span></h3>
                <button class="btn" id="matchJobsBtn">
                    <i class="fas fa-search-plus"></i> <span data-i18n-key="matchJobs">智能匹配岗位</span>
                </button>
                <div id="jobMatchResults" style="display: none; margin-top: 15px; padding: 15px; border: 1px solid var(--border-color); border-radius: 6px; position: relative;">
                    <button id="closeMatchResults" style="position: absolute; top: 5px; right: 10px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-light);">&times;</button>
                    <h4 style="margin-bottom: 10px;" data-i18n-key="matchResults">匹配结果:</h4>
                    <a id="zhipinLink" href="#" target="_blank" style="display: block; padding: 10px; margin-bottom: 5px; background: var(--primary-color); color: white; text-decoration: none; border-radius: 4px; text-align: center;" data-i18n-key="viewOnZhipin">在BOSS直聘上查看</a>
                    <a id="liepinLink" href="#" target="_blank" style="display: block; padding: 10px; background: var(--primary-color); color: white; text-decoration: none; border-radius: 4px; text-align: center;" data-i18n-key="viewOnLiepin">在猎聘网上查看</a>
                </div>
            </div>
            
            <div class="control-group">
                <h3><i class="fas fa-robot"></i> <span data-i18n-key="aiTipsSettings">AI提示设置</span></h3>
                <div class="ai-toggle">
                    <input type="checkbox" id="showAiTips" checked>
                    <label for="showAiTips" data-i18n-key="showAiTipsInEditor">在编辑器中显示AI提示</label>
                </div>
                <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 10px;">
                    <i class="fas fa-info-circle"></i> <span data-i18n-key="aiTipsInfo">AI提示仅在编辑时可见，导出PDF时自动隐藏</span>
                </p>
            </div>
            
            <div class="control-group">
                <h3><i class="fas fa-lightbulb"></i> <span data-i18n-key="usageTips">使用提示</span></h3>
                <ul style="color: var(--text-light); padding-left: 20px; font-size: 0.9rem;">
                    <li data-i18n-key="usageTip1">点击任何文本区域可直接编辑内容</li>
                    <li data-i18n-key="usageTip2">照片建议使用专业证件照或商务照</li>
                    <li data-i18n-key="usageTip3">在北美求职通常不放照片，亚洲/欧洲建议放</li>
                    <li data-i18n-key="usageTip4">AI提示仅用于编辑参考，不会出现在最终简历</li>
                </ul>
            </div>
        </div>
        
        <!-- 简历内容区域 -->
        <div class="resume-container" id="resumeContent">
                <div class="photo-container" id="photoContainer">
                    <div class="photo-preview" id="photoPreview">
                        <div class="photo-placeholder">
                            <i class="fas fa-user-circle"></i>
                            <p data-i18n-key="uploadPhotoPlaceholder">点击上传照片</p>
                        </div>
                    </div>
                    <div class="photo-actions">
                        <div class="photo-btn" id="changePhotoBtn">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="photo-btn" id="removePhotoBtn">
                            <i class="fas fa-trash-alt"></i>
                        </div>
                    </div>
                </div>

                <header>
                    <h1 contenteditable="true" data-i18n-key="name">张明</h1>
                    <div class="job-title" contenteditable="true" data-i18n-key="jobTitlePlaceholder">高级产品经理 | 用户增长方向</div>
                    <div class="contact">
                        <div class="contact-item" contenteditable="true" data-i18n-key="contactPhone">📱 13800138000</div>
                        <div class="contact-item" contenteditable="true" data-i18n-key="contactEmail">✉️ zhangming@email.com</div>
                        <div class="contact-item" contenteditable="true" data-i18n-key="contactLocation">📍 上海 | 北京</div>
                        <div class="contact-item" contenteditable="true" data-i18n-key="contactPortfolio">🔗 portfolio.com/zhangming</div>
                    </div>
                </header>

                <section id="summary">
                    <h2 data-i18n-key="summary">职业摘要</h2>
                    <div class="summary" contenteditable="true" data-i18n-key="summaryContent">
                        5年互联网产品经验，专注用户增长与商业化设计。主导3款百万级DAU产品迭代，曾实现30天新用户增长120%，付费转化率提升18%。擅长数据驱动决策与跨部门协作，获2024年度公司创新奖。
                    </div>
                </section>

                <section id="experience">
                    <h2>
                        <span data-i18n-key="experience">工作经历</span>
                        <button class="add-btn" id="addExperience">+</button>
                    </h2>
                    
                    <div class="experience-item">
                        <button class="delete-btn">×</button>
                        <div class="item-header">
                            <div class="company" contenteditable="true" data-i18n-key="exp1Company">腾讯 · 微信事业群</div>
                            <div class="date" contenteditable="true" data-i18n-key="exp1Date">2022年6月 - 至今</div>
                        </div>
                        <div class="position" contenteditable="true" data-i18n-key="exp1Position">高级产品经理（用户增长）</div>
                        <ul>
                            <li contenteditable="true" data-i18n-key="exp1Desc1">重构新用户引导流程，首周留存率提升<span class="highlight">32%</span>，获季度创新项目金奖</li>
                            <li contenteditable="true" data-i18n-key="exp1Desc2">设计社交裂变增长模型，3个月带来<span class="highlight">180万</span>新增用户，获客成本降低<span class="highlight">40%</span></li>
                            <li contenteditable="true" data-i18n-key="exp1Desc3">主导AB实验平台升级，实验迭代效率提升<span class="highlight">50%</span>，支持日均20+实验并行</li>
                        </ul>
                    </div>

                    <div class="experience-item">
                        <button class="delete-btn">×</button>
                        <div class="item-header">
                            <div class="company" contenteditable="true" data-i18n-key="exp2Company">字节跳动 · 抖音电商</div>
                            <div class="date" contenteditable="true" data-i18n-key="exp2Date">2020年3月 - 2022年5月</div>
                        </div>
                        <div class="position" contenteditable="true" data-i18n-key="exp2Position">产品经理</div>
                        <ul>
                            <li contenteditable="true" data-i18n-key="exp2Desc1">设计直播购物车优化方案，下单转化率提升<span class="highlight">22%</span>，GMV月增<span class="highlight">1.2亿</span></li>
                            <li contenteditable="true" data-i18n-key="exp2Desc2">搭建商家成长体系，优质商家留存率提高<span class="highlight">35%</span></li>
                        </ul>
                    </div>
                </section>

                <section id="education">
                    <h2>
                        <span data-i18n-key="education">教育经历</span>
                        <button class="add-btn" id="addEducation">+</button>
                    </h2>
                    <div class="experience-item">
                        <button class="delete-btn">×</button>
                        <div class="item-header">
                            <div class="company" contenteditable="true" data-i18n-key="edu1School">北京大学</div>
                            <div class="date" contenteditable="true" data-i18n-key="edu1Date">2016年9月 - 2020年6月</div>
                        </div>
                        <div class="position" contenteditable="true" data-i18n-key="edu1Degree">硕士 · 计算机科学</div>
                        <ul>
                            <li contenteditable="true" data-i18n-key="edu1Desc1">专业排名：Top 5%</li>
                            <li contenteditable="true" data-i18n-key="edu1Desc2">获得国家奖学金、北京市优秀毕业生</li>
                        </ul>
                    </div>
                </section>

                <section id="projects">
                    <h2>
                        <span data-i18n-key="projects">关键项目</span>
                        <button class="add-btn" id="addProject">+</button>
                    </h2>
                    <div class="project-item">
                        <button class="delete-btn">×</button>
                        <div class="item-header">
                            <div class="project-name" contenteditable="true" data-i18n-key="proj1Name">微信「购物圈」社交电商体系</div>
                            <div class="date" contenteditable="true" data-i18n-key="proj1Date">2023年3月-2023年10月</div>
                        </div>
                        <ul>
                            <li contenteditable="true" data-i18n-key="proj1Desc1">从0到1设计好友拼团系统，上线首月带动<span class="highlight">86万</span>笔订单</li>
                            <li contenteditable="true" data-i18n-key="proj1Desc2">建立UGC内容激励体系，用户内容贡献量提升<span class="highlight">150%</span></li>
                        </ul>
                    </div>
                </section>

                <section id="skills">
                    <h2>
                        <span data-i18n-key="skills">技能证书</span>
                        <button class="add-btn" id="addSkill">+</button>
                    </h2>
                    <div class="skills-container">
                        <div class="skill-tag"><span contenteditable="true" data-i18n-key="skill1">增长黑客方法论</span><button class="delete-tag-btn">×</button></div>
                        <div class="skill-tag"><span contenteditable="true" data-i18n-key="skill2">SQL/Python数据分析</span><button class="delete-tag-btn">×</button></div>
                        <div class="skill-tag"><span contenteditable="true" data-i18n-key="skill3">用户行为分析</span><button class="delete-tag-btn">×</button></div>
                        <div class="skill-tag"><span contenteditable="true" data-i18n-key="skill4">Axure/Sketch</span><button class="delete-tag-btn">×</button></div>
                        <div class="skill-tag"><span contenteditable="true" data-i18n-key="skill5">PMP认证</span><button class="delete-tag-btn">×</button></div>
                        <div class="skill-tag"><span contenteditable="true" data-i18n-key="skill6">Google Analytics</span><button class="delete-tag-btn">×</button></div>
                    </div>
                </section>

                <section id="ai-tips">
                    <h2 data-i18n-key="aiOptimizationTips">AI优化提示</h2>
                    <div class="ai-tips">
                        <ul>
                            <li id="quant-analysis-tip"></li>
                            <li id="keyword-analysis-tip"></li>
                            <li style="margin-top: 10px; font-style: italic;" data-i18n-key="aiTipsInfo">AI提示内容<strong>不会</strong>出现在最终导出的简历中</li>
                        </ul>
                    </div>
                </section>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">操作成功!</span>
    </div>
    
    <input type="file" id="fileInput" accept=".json" style="display: none;">
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- STATE MANAGEMENT ---
            let appState = {
                lang: 'zh',
                theme: 'light',
                color: '#2563eb',
                showPhoto: true,
                showAiTips: true,
                photoPreview: '',
                resumeData: {} // To store user-edited content
            };

            const i18nKeys = Object.keys(i18n.zh);

            // --- DOM ELEMENTS ---
            const photoUpload = document.getElementById('photoUpload');
            const uploadPhotoBtn = document.getElementById('uploadPhotoBtn');
            const photoPreview = document.getElementById('photoPreview');
            const changePhotoBtn = document.getElementById('changePhotoBtn');
            const removePhotoBtn = document.getElementById('removePhotoBtn');
            const showPhotoCheckbox = document.getElementById('showPhoto');
            const showAiTipsCheckbox = document.getElementById('showAiTips');
            const aiTipsSection = document.getElementById('ai-tips');
            const resumeContentContainer = document.getElementById('resumeContent');

            // --- I18N & RENDERING ---
            function switchLanguage(lang, isInitialLoad = false) {
                appState.lang = lang;
                document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';

                // Update all static text
                document.querySelectorAll('[data-i18n-key]').forEach(el => {
                    const key = el.dataset.i18nKey;
                    if (i18n[lang][key]) {
                        el.innerHTML = i18n[lang][key];
                    }
                });

                // Update contenteditable fields
                document.querySelectorAll('[contenteditable="true"]').forEach(el => {
                    const key = el.dataset.i18nKey;
                    if (isInitialLoad && appState.resumeData[key]) {
                        el.innerHTML = appState.resumeData[key];
                    } else {
                        el.innerHTML = i18n[lang][key] || '';
                    }
                });
                
                // Update UI state for language switcher
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.lang === lang);
                });

                analyzeResume();
                if (!isInitialLoad) {
                    saveState();
                }
            }
            
            function applyState() {
                // Apply theme and color
                document.body.setAttribute('data-theme', appState.theme);
                document.documentElement.style.setProperty('--primary-color', appState.color);
                
                document.querySelectorAll('.theme-btn').forEach(b => b.classList.toggle('active', b.dataset.theme === appState.theme));
                document.querySelectorAll('.color-option').forEach(opt => opt.classList.toggle('active', opt.dataset.color === appState.color));

                // Apply photo visibility and content
                showPhotoCheckbox.checked = appState.showPhoto;
                document.getElementById('photoContainer').style.display = appState.showPhoto ? 'flex' : 'none';
                if (appState.photoPreview) {
                    photoPreview.style.backgroundImage = appState.photoPreview;
                    photoPreview.innerHTML = '';
                } else {
                    photoPreview.style.backgroundImage = '';
                    photoPreview.innerHTML = `
                        <div class="photo-placeholder">
                            <i class="fas fa-user-circle"></i>
                            <p data-i18n-key="uploadPhotoPlaceholder">${i18n[appState.lang].uploadPhotoPlaceholder}</p>
                        </div>`;
                }

                // Apply AI tips visibility
                showAiTipsCheckbox.checked = appState.showAiTips;
                aiTipsSection.style.display = appState.showAiTips ? 'block' : 'none';
            }

            // --- DATA & STATE SYNC ---
            function scrapeDataFromDOM() {
                const newData = {};
                document.querySelectorAll('[contenteditable="true"]').forEach(el => {
                    const key = el.dataset.i18nKey;
                    if (key) {
                        newData[key] = el.innerHTML;
                    }
                });
                appState.resumeData = newData;
            }

            function saveState() {
                scrapeDataFromDOM();
                appState.photoPreview = photoPreview.style.backgroundImage;
                localStorage.setItem('resumeAppState', JSON.stringify(appState));
            }

            function loadState() {
                const savedState = localStorage.getItem('resumeAppState');
                if (savedState) {
                    try {
                        const loadedData = JSON.parse(savedState);
                        appState = { ...appState, ...loadedData };
                        showNotification(i18n[appState.lang].notifLoadedFromLocal);
                    } catch (e) {
                        console.error("Failed to load state, using defaults:", e);
                        // Proceed with default state if loading fails
                    }
                }
                // Assign keys to all editable elements for data mapping
                let contentCounter = 0;
                document.querySelectorAll('[contenteditable="true"]').forEach(el => {
                    if (!el.dataset.i18nKey) {
                       el.dataset.i18nKey = `customContent${contentCounter++}`;
                    }
                });
            }

            // --- EVENT LISTENERS ---
            
            // Language Switcher
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchLanguage(this.dataset.lang);
                });
            });

            // Theme Switcher
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    appState.theme = this.dataset.theme;
                    applyState();
                    saveState();
                });
            });

            // Color Options
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    appState.color = this.dataset.color;
                    applyState();
                    saveState();
                });
            });

            // Photo Upload
            uploadPhotoBtn.addEventListener('click', () => photoUpload.click());
            changePhotoBtn.addEventListener('click', () => photoUpload.click());
            photoPreview.addEventListener('click', () => photoUpload.click());
            photoUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        appState.photoPreview = `url(${event.target.result})`;
                        appState.showPhoto = true;
                        applyState();
                        saveState();
                    };
                    reader.readAsDataURL(file);
                }
            });
            removePhotoBtn.addEventListener('click', function() {
                appState.photoPreview = '';
                appState.showPhoto = false;
                applyState();
                saveState();
            });
            showPhotoCheckbox.addEventListener('change', function() {
                appState.showPhoto = this.checked;
                applyState();
                saveState();
            });

            // AI Tips Toggle
            showAiTipsCheckbox.addEventListener('change', function() {
                appState.showAiTips = this.checked;
                applyState();
                saveState();
            });

            // ContentEditable changes
            resumeContentContainer.addEventListener('input', (e) => {
                if(e.target.hasAttribute('contenteditable')) {
                    // Auto-remove empty list items for better UX
                    if (e.target.tagName === 'LI' && e.target.textContent.trim() === '') {
                        setTimeout(() => {
                            if (e.target && e.target.textContent.trim() === '') {
                                e.target.remove();
                                saveState(); // Save state after removing the element
                            }
                        }, 1200);
                    }

                    const key = e.target.dataset.i18nKey;
                    if (key) {
                        appState.resumeData[key] = e.target.innerHTML;
                        analyzeResume();
                        saveState();
                    }
                }
            });

            // Add new list item on Enter key
            resumeContentContainer.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const selection = window.getSelection();
                    const parentLi = selection.anchorNode.parentElement.closest('li[contenteditable="true"]');

                    if (parentLi) {
                        e.preventDefault(); // Prevent default Enter behavior

                        const newLi = document.createElement('li');
                        newLi.setAttribute('contenteditable', 'true');
                        
                        // Assign a unique key for data management
                        const keyBase = `customLi-${Date.now()}`;
                        newLi.dataset.i18nKey = keyBase;

                        // Insert the new li after the current one
                        parentLi.parentNode.insertBefore(newLi, parentLi.nextSibling);

                        // Focus on the new li and move cursor into it
                        const range = document.createRange();
                        const sel = window.getSelection();
                        range.setStart(newLi, 0);
                        range.collapse(true);
                        sel.removeAllRanges();
                        sel.addRange(range);

                        // Save state after adding the new item
                        saveState();
                    }
                }
            });

            // Save to local button
            document.getElementById('saveLocal').addEventListener('click', function() {
                saveStateToFile();
            });

            function saveStateToFile() {
                scrapeDataFromDOM();
                const stateString = JSON.stringify(appState, null, 2);
                const blob = new Blob([stateString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'resume-state.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification(i18n[appState.lang].notifSavedToBrowser);
            }
            
            // Reset button
            document.getElementById('resetTemplate').addEventListener('click', function() {
                if (confirm(i18n[appState.lang].notifResetConfirm)) {
                    localStorage.removeItem('resumeAppState');
                    window.location.reload();
                }
            });

            // Load from file
            const fileInput = document.getElementById('fileInput');
            document.getElementById('loadLocal').addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const loadedState = JSON.parse(event.target.result);
                        // Validate and merge
                        appState = { ...appState, ...loadedState };
                        saveState(); // Save the merged state to localStorage
                        applyState();
                        switchLanguage(appState.lang, true);
                        showNotification(i18n[appState.lang].notifImportSuccess);
                    } catch (error) {
                        showNotification(i18n[appState.lang].notifImportError + ' ' + error.message);
                        console.error("File import failed:", error);
                    }
                };
                reader.readAsText(file);
                // Reset file input to allow loading the same file again
                e.target.value = '';
            });

            // Smart Job Matching
            document.getElementById('matchJobsBtn').addEventListener('click', function() {
                const cityCodes = {
                    'zhipin': { '北京': '101010100', '上海': '101020100', '广州': '101280100', '深圳': '101280600', '杭州': '101210100' },
                    'liepin': { '北京': '010', '上海': '020', '广州': '050020', '深圳': '050090', '杭州': '070020' }
                };
                const jobTitle = appState.resumeData.jobTitlePlaceholder || '';
                const locationText = appState.resumeData.contactLocation || '';
                const skills = [appState.resumeData.skill1, appState.resumeData.skill2].filter(Boolean);

                if (!jobTitle) {
                    showNotification(i18n[appState.lang].notifEnterJobTitle);
                    return;
                }

                let city = '';
                for (const cityName in cityCodes.zhipin) {
                    if (locationText.includes(cityName)) {
                        city = cityName;
                        break;
                    }
                }

                const queryKeywords = [jobTitle.split('|')[0].trim(), ...skills];
                const encodedQuery = encodeURIComponent(queryKeywords.join(' '));
                const zhipinCityCode = city ? cityCodes.zhipin[city] : '';
                const liepinCityCode = city ? cityCodes.liepin[city] : '';

                const zhipinUrl = `https://www.zhipin.com/web/geek/job?query=${encodedQuery}${zhipinCityCode ? '&city=' + zhipinCityCode : ''}`;
                const liepinUrl = `https://www.liepin.com/zhaopin/?key=${encodedQuery}${liepinCityCode ? '&city=' + liepinCityCode : ''}`;

                document.getElementById('zhipinLink').href = zhipinUrl;
                document.getElementById('liepinLink').href = liepinUrl;
                document.getElementById('jobMatchResults').style.display = 'block';
                showNotification(i18n[appState.lang].notifMatchGenerated);
            });

            document.getElementById('closeMatchResults').addEventListener('click', function() {
                document.getElementById('jobMatchResults').style.display = 'none';
            });

            // --- DYNAMIC CONTENT (ADD/DELETE) ---
            // (This part remains largely the same, but uses i18n for notifications)
            
            // Add Experience
            document.getElementById('addExperience').addEventListener('click', function() {
                const newExperience = createDynamicItem('experience');
                document.getElementById('experience').appendChild(newExperience);
                attachDeleteEvent(newExperience.querySelector('.delete-btn'));
                saveState();
                showNotification(i18n[appState.lang].notifAddExperience);
            });

            // Add Project
            document.getElementById('addProject').addEventListener('click', function() {
                const newProject = createDynamicItem('project');
                document.getElementById('projects').appendChild(newProject);
                attachDeleteEvent(newProject.querySelector('.delete-btn'));
                saveState();
                showNotification(i18n[appState.lang].notifAddProject);
            });

            // Add Education
            document.getElementById('addEducation').addEventListener('click', function() {
                const newEducation = createDynamicItem('education');
                document.getElementById('education').appendChild(newEducation);
                attachDeleteEvent(newEducation.querySelector('.delete-btn'));
                saveState();
                showNotification(i18n[appState.lang].notifAddEducation);
            });

            // Add Skill
            document.getElementById('addSkill').addEventListener('click', function() {
                const skillsContainer = document.querySelector('.skills-container');
                const newSkill = createDynamicItem('skill');
                skillsContainer.appendChild(newSkill);
                attachTagDeleteEvent(newSkill.querySelector('.delete-tag-btn'));
                saveState();
                showNotification(i18n[appState.lang].notifAddSkill);
            });

            function createDynamicItem(type) {
                const item = document.createElement('div');
                let content = '';
                let keyBase = `${type}-${Date.now()}`;
                switch(type) {
                    case 'experience':
                        item.className = 'experience-item';
                        content = `
                            <button class="delete-btn">×</button>
                            <div class="item-header">
                                <div class="company" contenteditable="true" data-i18n-key="${keyBase}-company">${i18n[appState.lang].newCompanyName}</div>
                                <div class="date" contenteditable="true" data-i18n-key="${keyBase}-date">${i18n[appState.lang].newDatePlaceholder}</div>
                            </div>
                            <div class="position" contenteditable="true" data-i18n-key="${keyBase}-position">${i18n[appState.lang].newPositionName}</div>
                            <ul><li contenteditable="true" data-i18n-key="${keyBase}-desc1">${i18n[appState.lang].newAchievementDesc}</li></ul>`;
                        break;
                    case 'project':
                         item.className = 'project-item';
                         content = `
                            <button class="delete-btn">×</button>
                            <div class="item-header">
                                <div class="project-name" contenteditable="true" data-i18n-key="${keyBase}-name">${i18n[appState.lang].newProjectName}</div>
                                <div class="date" contenteditable="true" data-i18n-key="${keyBase}-date">${i18n[appState.lang].newDatePlaceholder}</div>
                            </div>
                            <ul><li contenteditable="true" data-i18n-key="${keyBase}-desc1">${i18n[appState.lang].newProjectAchievement}</li></ul>`;
                        break;
                    case 'education':
                        item.className = 'experience-item';
                        content = `
                            <button class="delete-btn">×</button>
                            <div class="item-header">
                                <div class="company" contenteditable="true" data-i18n-key="${keyBase}-school">${i18n[appState.lang].newSchoolName}</div>
                                <div class="date" contenteditable="true" data-i18n-key="${keyBase}-date">${i18n[appState.lang].newDatePlaceholder}</div>
                            </div>
                            <div class="position" contenteditable="true" data-i18n-key="${keyBase}-degree">${i18n[appState.lang].newDegree}</div>
                            <ul><li contenteditable="true" data-i18n-key="${keyBase}-desc1">${i18n[appState.lang].newAcademicAchievement}</li></ul>`;
                        break;
                    case 'skill':
                        item.className = 'skill-tag';
                        content = `<span contenteditable="true" data-i18n-key="${keyBase}-skill">${i18n[appState.lang].newSkill}</span><button class="delete-tag-btn">×</button>`;
                        break;
                }
                item.innerHTML = content;
                return item;
            }

            function attachDeleteEvent(btn) {
                btn.addEventListener('click', function() {
                    this.parentElement.remove();
                    saveState();
                    showNotification(i18n[appState.lang].notifDeleteItem);
                });
            }
            function attachTagDeleteEvent(btn) {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    this.parentElement.remove();
                    saveState();
                    showNotification(i18n[appState.lang].notifDeleteSkill);
                });
            }
            document.querySelectorAll('.delete-btn').forEach(attachDeleteEvent);
            document.querySelectorAll('.delete-tag-btn').forEach(attachTagDeleteEvent);


            // --- PDF EXPORT ---
            // (Remains mostly the same, but uses i18n for notifications)
            document.getElementById('exportPdf').addEventListener('click', function() {
                showNotification(i18n[appState.lang].notifGeneratingPDF);
                // ... (rest of the PDF generation code is unchanged)
                const resumeContainer = document.getElementById('resumeContent');
                const aiTipsSection = document.getElementById('ai-tips');

                const originalBoxShadow = resumeContainer.style.boxShadow;
                const originalBodyBg = document.body.style.backgroundImage;
                const aiTipsOriginalDisplay = aiTipsSection.style.display;

                document.querySelectorAll('.add-btn, .delete-btn, .delete-tag-btn, .photo-actions').forEach(btn => {
                    btn.style.visibility = 'hidden';
                });
                aiTipsSection.style.display = 'none';
                resumeContainer.style.boxShadow = 'none';
                document.body.style.backgroundImage = 'none';
                
                const isDarkMode = document.body.getAttribute('data-theme') === 'dark';
                const bgColor = isDarkMode ? '#0f172a' : '#ffffff';
                
                html2canvas(resumeContainer, {
                    scale: 2.3, useCORS: true, logging: false, backgroundColor: bgColor,
                    height: resumeContainer.scrollHeight, windowHeight: resumeContainer.scrollHeight
                }).then(canvas => {
                    const contentWidth = canvas.width;
                    const contentHeight = canvas.height;
                    const pageHeight_mm = 297;
                    const pageWidth_mm = 210;
                    const imgWidth_mm = pageWidth_mm;
                    const imgHeight_mm = contentHeight * imgWidth_mm / contentWidth;
                    let pageCount = Math.ceil(imgHeight_mm / pageHeight_mm);
                    pageCount = pageCount < 1 ? 1 : pageCount;

                    const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                    const imgData = canvas.toDataURL('image/png');
                    
                    if (imgHeight_mm <= pageHeight_mm) {
                        pdf.addImage(imgData, 'PNG', 0, 0, imgWidth_mm, imgHeight_mm, undefined, 'FAST');
                    } else {
                        let position = 0;
                        for (let i = 0; i < pageCount; i++) {
                            if (i > 0) pdf.addPage();
                            pdf.addImage(imgData, 'PNG', 0, -position, imgWidth_mm, imgHeight_mm, undefined, 'FAST');
                            position += pageHeight_mm;
                        }
                    }
                    pdf.save('resume.pdf');
                    showNotification(`${i18n[appState.lang].notifPDFSuccess} (${pageCount} ${i18n[appState.lang].notifPDFSuccessPage})!`);
                }).catch(err => {
                    showNotification(i18n[appState.lang].notifPDFFail + err.message);
                    console.error("PDF generation failed:", err);
                }).finally(() => {
                    resumeContainer.style.boxShadow = originalBoxShadow;
                    document.body.style.backgroundImage = originalBodyBg;
                    document.querySelectorAll('.add-btn, .delete-btn, .delete-tag-btn, .photo-actions').forEach(btn => {
                        btn.style.visibility = 'visible';
                    });
                    aiTipsSection.style.display = aiTipsOriginalDisplay;
                });
            });

            // --- AI ANALYSIS ---
            // (Unchanged)
            function analyzeResume() {
                const quantTipElement = document.getElementById('quant-analysis-tip');
                const keywordTipElement = document.getElementById('keyword-analysis-tip');
                if (!quantTipElement || !keywordTipElement) return;

                const listItems = document.querySelectorAll('#experience li, #education li, #projects li');
                const totalItems = listItems.length;
                let quantifiedItems = 0;
                const quantRegex = /\d|%/;
                listItems.forEach(item => {
                    if (quantRegex.test(item.textContent)) quantifiedItems++;
                });

                let quantMessage = `<strong>${i18n[appState.lang].quantAnalysisTitle || '量化成果分析'}</strong>: ${i18n[appState.lang].quantAnalysisNoData || '暂无描述可分析。'}`;
                if (totalItems > 0) {
                    const percentage = Math.round((quantifiedItems / totalItems) * 100);
                    quantMessage = `<strong>${i18n[appState.lang].quantAnalysisTitle || '量化成果分析'}</strong>: ${i18n[appState.lang].quantAnalysisSummary.replace('{quantified}', `<strong>${quantifiedItems}/${totalItems}</strong>`).replace('{percentage}', `<strong>${percentage}%</strong>`)}`;
                    quantMessage += percentage < 50 ? (i18n[appState.lang].quantAnalysisSuggestion || ' 建议增加更多量化成果！') : (i18n[appState.lang].quantAnalysisExcellent || ' 非常出色！');
                }
                quantTipElement.innerHTML = quantMessage;

                // --- 2. Keyword Match Analysis ---
                const keywordMap = i18n[appState.lang].keywordMap;
                const jobTitle = document.querySelector('[data-i18n-key="jobTitlePlaceholder"]').textContent.toLowerCase();
                const resumeText = resumeContentContainer.textContent.toLowerCase();
                let targetKeywords = [];
                let matchedJob = i18n[appState.lang].keywordAnalysisDefaultJob;

                for (const jobKey in keywordMap) {
                    if (jobTitle.includes(keywordMap[jobKey].name.toLowerCase())) {
                        targetKeywords = keywordMap[jobKey].keywords;
                        matchedJob = keywordMap[jobKey].name;
                        break;
                    }
                }

                let keywordMessage = `<strong>${i18n[appState.lang].keywordAnalysisTitle} (${matchedJob})</strong>: `;
                if (targetKeywords.length > 0) {
                    const foundKeywords = targetKeywords.filter(kw => resumeText.includes(kw.toLowerCase()));
                    const missingKeywords = targetKeywords.filter(kw => !resumeText.includes(kw.toLowerCase()));
                    
                    keywordMessage += i18n[appState.lang].keywordAnalysisSummary.replace('{found}', `<strong>${foundKeywords.length}/${targetKeywords.length}</strong>`);
                    if (missingKeywords.length > 0) {
                        keywordMessage += i18n[appState.lang].keywordAnalysisSuggestion.replace('{keywords}', `<strong>${missingKeywords.slice(0, 2).join(', ')}</strong>`);
                    }
                } else {
                    keywordMessage += i18n[appState.lang].keywordAnalysisNoKeywords;
                }
                keywordTipElement.innerHTML = keywordMessage;
            }

            // --- UTILS ---
            function showNotification(text) {
                const notification = document.getElementById('notification');
                const textElement = document.getElementById('notificationText');
                textElement.textContent = text;
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }

            // --- INITIALIZATION ---
            loadState();
            applyState();
            switchLanguage(appState.lang, true);
        });
    </script>
</body>
</html>
